(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver(e=>{for(const s of e)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function n(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?s.credentials="include":e.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(e){if(e.ep)return;e.ep=!0;const s=n(e);fetch(e.href,s)}})();class g{constructor(){this.audioContext=null,this.analyser=null,this.source=null,this.dataArray=null,this.stream=null}async startCapture(){try{if(this.stream=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:{echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1}}),this.stream.getAudioTracks().length===0)throw this.stop(),new Error('No audio track selected. Did you check "Share system audio"?');this.setupAudioContext(this.stream),this.stream.getVideoTracks()[0].onended=()=>{this.stop()}}catch(t){throw console.error("Error in startCapture:",t),t}}async startMicrophone(){try{this.stream=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1},video:!1}),this.setupAudioContext(this.stream)}catch(t){throw console.error("Error in startMicrophone:",t),t}}setupAudioContext(t){this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2048,this.analyser.smoothingTimeConstant=.8,this.source=this.audioContext.createMediaStreamSource(t),this.source.connect(this.analyser);const n=this.analyser.frequencyBinCount;this.dataArray=new Uint8Array(n)}getFrequencyData(){return this.analyser?(this.analyser.getByteFrequencyData(this.dataArray),this.dataArray):new Uint8Array(0)}getWaveformData(){return this.analyser?(this.analyser.getByteTimeDomainData(this.dataArray),this.dataArray):new Uint8Array(0)}stop(){this.stream&&this.stream.getTracks().forEach(t=>t.stop()),this.audioContext&&this.audioContext.close(),window.location.reload()}}class v{constructor(t,n){this.canvas=t,this.ctx=t.getContext("2d"),this.audioController=n,this.isRunning=!1,this.mode="bars",this.sensitivity=1.5,this.resize()}resize(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.centerX=this.canvas.width/2,this.centerY=this.canvas.height/2}setMode(t){this.mode=t}setSensitivity(t){this.sensitivity=t}start(){this.isRunning||(this.isRunning=!0,this.animate())}stop(){this.isRunning=!1}animate(){this.isRunning&&(requestAnimationFrame(()=>this.animate()),this.ctx.fillStyle="rgba(10, 10, 10, 0.2)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.mode==="bars"?this.drawBars():this.drawWave())}drawBars(){const t=this.audioController.getFrequencyData(),n=t.length,a=Math.floor(n*.7),e=this.canvas.width/a*2.5;let s=0;for(let r=0;r<a;r++){const c=t[r]/255,o=c*this.canvas.height*.5*this.sensitivity,f=r/a*360+c*50,m=50+c*30;if(this.ctx.fillStyle=`hsl(${f}, 100%, ${m}%)`,this.ctx.fillRect(this.centerX+s,this.centerY-o/2,e,o),this.ctx.fillRect(this.centerX-s-e,this.centerY-o/2,e,o),s+=e+1,s>this.centerX)break}}drawWave(){const t=this.audioController.getWaveformData(),n=t.length,a=this.canvas.width/n;this.ctx.lineWidth=3,this.ctx.strokeStyle=`hsl(${Date.now()/50%360}, 100%, 50%)`,this.ctx.beginPath();let e=0;for(let s=0;s<n;s++){const r=t[s]/128;r*this.canvas.height/2*this.sensitivity+(this.canvas.height/2-this.canvas.height/2*this.sensitivity);const c=r-1,o=this.centerY+c*(this.canvas.height/2)*this.sensitivity;s===0?this.ctx.moveTo(e,o):this.ctx.lineTo(e,o),e+=a}this.ctx.lineTo(this.canvas.width,this.centerY),this.ctx.stroke()}}const p=document.getElementById("start-btn"),w=document.getElementById("mic-btn"),C=document.getElementById("overlay"),x=document.getElementById("controls"),A=document.getElementById("visualizer"),E=document.getElementById("sensitivity"),d=document.querySelectorAll(".mode-btn");let l,h;async function L(){try{l=new g,h=new v(A,l),p.addEventListener("click",()=>u("system")),w.addEventListener("click",()=>u("mic")),E.addEventListener("input",i=>{h.setSensitivity(parseFloat(i.target.value))}),d.forEach(i=>{i.addEventListener("click",()=>{d.forEach(t=>t.classList.remove("active")),i.classList.add("active"),h.setMode(i.dataset.mode)})}),window.addEventListener("resize",()=>{h.resize()})}catch(i){console.error("Initialization error:",i)}}async function u(i){try{i==="system"?await l.startCapture():await l.startMicrophone(),C.classList.add("hidden"),x.classList.remove("hidden"),h.start()}catch(t){console.error("Error starting audio capture:",t),alert(i==="system"?'Could not start system audio capture. Try using the "Use Microphone" button or ensure you select a Tab with audio.':"Could not access microphone. Please check permissions.")}}L();
